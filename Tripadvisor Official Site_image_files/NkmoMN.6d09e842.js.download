(this.$WP=this.$WP||[]).push(["NkmoMN",(e,a)=>{"use strict";var t,r,n,s,o,i,l,u,c,g,p,m,d,v,S,h,f,b,k,_,y,w,I,x,M,N,P,C,T,O,A,E=e=>{var{page:a,params:t}=e,r=t.showHighlightOnHR?t.showHighlightOnHR:null;return"Hotel_Review"===a&&1===r},H=(e,a,t)=>{var r={...e.current};r[a]=[...new Set([...r[a]||[],t])],e.current=r},F=["vf_awareness_campaign_1632751047"],V="edu_general",R="edu_hotels",D="edu_experiences",L="edu_general_p2",B="edu_hotels_p2",U="edu_experiences_p2",K="edu_general_p3",j="edu_hotels_p3",G="edu_experiences_p3",J=["Attractions","Attraction_Review","AttractionsFusion","AttractionsHome","AttractionsNear","AttractionToursAndTickets"],$=["Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],q=["Attraction_Products","AttractionProductReview","AttractionProductsFusion","OptimusHotelCheckout","OptimusSubscriptionCheckout","Plus","Restaurant_Review","Restaurants","RestaurantsHome","RestaurantsNear"],z=["AttractionsHome","Attractions","AttractionsFusion","Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],Q="control",W=e=>I.includes(e),X="interstitialData",Y=e=>e?new Map(JSON.parse(e)):new Map,Z=(e,a,t)=>{var r=Y(e).get(a),n=(new Date).getTime();return r&&(null==r?void 0:r.find((e=>e.key===t&&(!e.ttl||e.ttl>=n))))||null},ee=(e,a,t,r)=>{var n;return((null==(n=Z(e,a,t))?void 0:n.value)||r)+0},ae=(e,a,t,r)=>{var n,s;return!!(null!=(n=null==(s=Z(e,a,t))?void 0:s.value)?n:r)},te=(e,a,t)=>{var r,n=e.get(a),s=(new Date).getTime();n=(null==(r=n)?void 0:r.filter((e=>e.key!==t.key&&(!e.ttl||e.ttl>=s))))||[];var o=t;return o.ttl&&(o.ttl+=s),n.push(o),e.set(a,n),e},re=(e,a,t,r)=>{var n=Y(d.get(X)||"");te(n,e,{key:a,value:t,ttl:r}),d.set(X,JSON.stringify(Array.from(n.entries())))},ne=(e,a,t)=>{var r=Y(v.get(X)||"");te(r,e,{key:a,value:t}),v.set(X,JSON.stringify(Array.from(r.entries())))},se="pageViews",oe="delayPageViews",ie="sessionPreviouslySeenGhost",le="previouslySeenInterval",ue="previouslySeenTotal",ce="previouslySeenIntervalGhost",ge="previouslySeenTotalGhost",pe="IneligibilityLogged",me=/^https?:\/\/[a-z\-\.]+\.tripadvisor\.[a-z\-\.]+/,de="interstitialData",ve=({children:e,onShow:a,delaySeconds:r,delayPageViews:n,afterPageViews:s,maxSeen:o,maxSeenSession:i,campaignInfo:l,isDatePickerOpen:g,suppress:m,ignoreInterval:f,onSkip:b,fallback:k=null,isControl:_=!1})=>{var{campaignName:y,variant:w}=l,I=t.useMemo((()=>d.get(de)||""),[]),x=t.useMemo((()=>v.get(de)||""),[]),C=t.useMemo((()=>M.getNumberFromStorage(I,y,se,0)),[I,y]),T=t.useMemo((()=>M.getNumberFromStorage(I,y,oe,0)),[I,y]),O=t.useMemo((()=>M.getBooleanFromStorage(I,y,le,!1)),[I,y]),A=t.useMemo((()=>M.getNumberFromStorage(I,y,ue,0)),[I,y]),E=t.useMemo((()=>M.getNumberFromStorage(x,y,"sessionPreviouslySeenCounter",0)),[x,y]),F=t.useMemo((()=>M.getBooleanFromStorage(I,y,ce,!1)),[I,y]),V=t.useMemo((()=>M.getNumberFromStorage(I,y,ge,0)),[I,y]),R=t.useMemo((()=>M.getNumberFromStorage(x,y,ie,0)),[x,y]),D=t.useRef({}),[L,B]=t.useState(!1),{funnelKey:U}=t.useContext(p),[{page:K},{uid:j}]=t.useContext(u),{sessionId:G,userId:J}=t.useContext(c),$=S(),q=h();t.useEffect((()=>{!f&&O||M.saveValueToLocalStorage(y,se,C+1,P)}),[y,C,O,f]),t.useEffect((()=>{(m||g)&&B(!1)}),[m,g]);var z=t.useMemo((()=>{var e=document.referrer;return!!e&&!me.test(e)}),[]),Q=t.useMemo((()=>!g&&C>=s&&(f||!O)&&A<o&&E<i),[g,C,s,O,A,E,o,i,f]);return t.useEffect((()=>{!Q&&b&&b()}),[Q,b]),t.useEffect((()=>{var e=!!z&&T<n,t=M.getBooleanFromStorage(I,y,pe,!1);if(Q){e&&M.saveValueToLocalStorage(y,oe,T+1,P);var l=setTimeout((()=>{document.querySelector('[title="regcontroller"]')||document.getElementById("explicitPreferences")||((f||!F)&&R<i&&A<o&&Q&&!g&&($({optimusMarketingInterstitial:{name:_?`control_${w}`:w,pageviewUid:j}}),_&&(M.saveValueToSessionStorage(y,ie,R+1),M.saveValueToLocalStorage(y,ce,!0,N),M.saveValueToLocalStorage(y,ge,V+1,P))),m||!Q||g||(M.saveValueToSessionStorage(y,ie,E+1),M.saveValueToLocalStorage(y,le,!0,N),M.saveValueToLocalStorage(y,ue,A+1,P),B(!0),a&&a()))}),e?1e3*r:0);return()=>clearTimeout(l)}return t||(C<s&&H(D,"common","notEnoughPageViews"),O&&H(D,"common","seenMaxInterval"),E>=i&&H(D,"common","seenMaxSession"),A>=o&&H(D,"common","seenMaxOverall"),Object.keys(D.current).length>0&&(M.saveValueToLocalStorage(y,pe,!0,N),q({externalKey:U,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:K,pageUid:j,sessionId:G,team:"Plus",userId:J,customData:JSON.stringify({...D.current})}))),()=>{}}),[Q,z,B,r,n,T,E,R,A,V,F,o,i,g,a,m,$,j,w,_,f,q,U,K,G,J,D,C,s,O,y,I]),L?e:k},Se="plusMarketingInterstitial",he="edu_general",fe="edu_hotels",be="edu_experiences",ke="edu_general_p2",_e="edu_hotels_p2",ye="edu_experiences_p2",we="edu_general_p3",Ie="edu_hotels_p3",xe="edu_experiences_p3",Me=({delaySeconds:e=30,afterPageViews:a=0,delayPageViews:t=1,maxSeen:l=3,maxSeenSession:m=1,isDatePickerOpen:d,onPopupDismiss:v,onOpen:S,onClose:k,fallback:I=null})=>{var M=s({}),[N,P]=n(null),{isOptimusEnabled:X,isOptimusSubscribed:Y}=b(),[{page:Z},{uid:ee}]=r(u),ae=(e=>{var a=(e=>{var a,[t]=r(u),{cashbackEnabled:n}=y(),s=(e=>q.includes(e.page)||(e=>{var{page:a,params:t}=e,r=t.showHighlightOnHR?t.showHighlightOnHR:null;return"Hotel_Review"===a&&1!==r})(e))(t),o=n&&!s;o&&(a="vf_awareness_campaign_1632751047");var i=w(a);return null===n||null===i&&o?null:i===Q?(H(e,"cashbackAwareness","control"),Q):(n||H(e,"cashbackAwareness","cashbackDisabled"),s&&H(e,"cashbackAwareness","excludedPage"),i&&x.includes(i)?"p3"===i?$.includes(t.page)||E(t)?j:J.includes(t.page)?G:K:"p2"===i?$.includes(t.page)||E(t)?B:J.includes(t.page)?U:L:$.includes(t.page)||E(t)?R:J.includes(t.page)?D:V:"")})(e);return null===a?null:{campaignName:"cashbackAwareness",variant:a}})(M),te=(()=>{var[{page:e,params:a}]=r(u),t=a.discountCode||null,n=!("Plus"!==e||!a.autopop&&""!==a.autopop||!t),s="Plus"===e&&null!==a.autopop&&"SUMMER0"===a.autopop;return n||s})(),re=(e=>{var[a]=r(u);return W(e)&&(z.includes(a.page)||E(a))})(null==N?void 0:N.variant),ne=(()=>{var{userId:e}=r(c),a=f({experimentKeys:F,userId:e||void 0,skipImpression:!0});return null===a?null:Object.keys(a).length>0})(),se=h(),{funnelKey:oe}=r(p),{sessionId:ie,userId:le}=r(c),{viewportCategory:ue}=r(g),ce="MOBILE"===ue;o((()=>{null===N&&P(ae)}),[oe,se,ae,X,Y,Z,ee,N,ie,le]),o((()=>{null!==N&&(X||H(M,"common","optimusDisabled"),Y&&H(M,"common","alreadySubscribed"),re&&ce&&H(M,"cashbackAwareness","mobileSupressed"),ne&&Object.keys(M.current).length>0&&se({externalKey:oe,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:Z,pageUid:ee,sessionId:ie,team:"Plus",userId:le,customData:JSON.stringify({...M.current})}))}),[oe,se,re,ne,ce,X,Y,Z,ee,N,ie,le]);var ge=i((()=>{k&&k(),v&&v()}),[k,v]);if(null===N||null===ne)return null;if("control"===N.variant||!X||Y||!N.variant)return v&&v(),I;var pe=(({variant:e,discountCode:a,onInterstitialClose:t})=>A.includes(e)?(({variant:e,onInterstitialClose:a})=>{var t;switch(e){case he:t="earn-general";break;case fe:t="earn-hotels";break;case be:t="earn-experiences";break;case ke:t="earn-general-p2";break;case _e:t="earn-hotels-p2";break;case ye:t="earn-experiences-p2";break;case we:t="earn-general-p3";break;case Ie:t="earn-hotels-p3";break;case xe:t="earn-experiences-p3";break;default:throw new Error(`Education interstitial not implemented for variant ${e}`)}return _(O,{variant:t,onClose:()=>a(),dataAutomationTag:Se})})({variant:e,onInterstitialClose:t}):(({variant:e,discountCode:a,onInterstitialClose:t})=>{var r,n=null==a?void 0:a.toUpperCase();switch(e){case"not-yet-implemented":r="not-implemented";break;default:throw new Error(`Discount interstitial not implemented for variant ${e}`)}return _(T,{code:n||"25OFF",onClose:()=>t(),variant:r,dataAutomationTag:Se})})({variant:e,discountCode:a,onInterstitialClose:t}))({variant:N.variant,onInterstitialClose:ge}),me=l,de=m;return te?(me=Number.MAX_SAFE_INTEGER,de=Number.MAX_SAFE_INTEGER):W(N.variant)&&(me=2,de=1),_(C,{delaySeconds:e,delayPageViews:te?0:t,afterPageViews:a,maxSeen:me,maxSeenSession:de,campaignInfo:N,isDatePickerOpen:d,onSkip:v,ignoreInterval:te,onShow:S,fallback:I,suppress:re&&ce,children:pe})},Ne=e=>{var[a]=n(l());return _(m,{funnelKey:a,children:_(Me,{...e})})};return[()=>{I=[D,V,R,L,B,U,K,j,G],x=["p1","p2","p3"],M={getNumberFromStorage:ee,getBooleanFromStorage:ae,saveValueToLocalStorage:re,saveValueToSessionStorage:ne},P=14*(N=864e5),C=ve,T=k.component.onUsage((()=>a("_MrER3")),"default"),O=k.component.onUsage((()=>a("NkmoMN/DVf7dM")),"default"),A=[he,fe,be,ke,_e,ye,we,Ie,xe],e("default",Ne)},[e=>(t=e.default,r=e.useContext,n=e.useState,s=e.useRef,o=e.useEffect,i=e.useCallback),e=>l=e.uuid,e=>(u=e.Route,c=e.Visitor,g=e.Device),e=>(p=e.FunnelTracking,m=e.FunnelTrackingProvider),e=>d=e.default,e=>v=e.default,e=>(S=e.useImpressionLogger,h=e.useImpressionV3Logger),e=>f=e.default,e=>b=e.useOptimusEnabledForUser,e=>k=e,e=>_=e.jsx,e=>(y=e.useCashbackEnabledRaw,w=e.useExperimentBucket)]]},["cDcdfi","O-HcBE","2R4xv2","ETqDaL","jaCyxS","qKFflQ","30t50h","S-RL4Q","v_y45t","pLbCP4","F5FCuN","tVuenP"]]);
