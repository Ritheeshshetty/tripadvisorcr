(this.$WP=this.$WP||[]).push(["S07X1M/mAbcFr",(e,o)=>{"use strict";var a,r,l,t,i,n,d,s,p,u,c,m,h,f,g,v,b,w,U,F,C=(e,o)=>{var[r,l]=a.useState(!1),t=p();return g("dragover",(e=>{var o=e;null!=o.dataTransfer&&[...o.dataTransfer.items].some((e=>"file"===e.kind))&&(o.dataTransfer.dropEffect="copy",o.preventDefault(),l(!0))})),g("dragleave",(e=>{r&&(e.preventDefault(),l(!1))})),g("drop",(a=>{if(r){var i=a;i.preventDefault(),l(!1);var n=[];null!=i.dataTransfer&&(n=(i.dataTransfer.items?[...i.dataTransfer.items].map((e=>e.getAsFile())):[...i.dataTransfer.files]).filter(Boolean)),n.length>0&&(null!==o&&t({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedDragDrop",description:o.length.toString()}}}),e(n))}})),{dragging:r}},_=[".mp4",".m4v",".mov"],P=(e,o,r)=>{var{localize:l}=t(),i=a.useCallback((e=>"video"===r?`${e.name}: ${l.string("post_video_file_type_error")}`:`${e.name}: ${l.string("post_photo_unsupported_file")}`),[l,r]),n=a.useCallback((e=>"video"===r?`${e.name}: ${l.string("post_video_size_error")}`:`${e.name}: ${l.string("file_size_too_big_photo_oops_message",{0:l.string("mobile_offline_megabyte_ffffec6c",{0:o/1024/1024})})}`),[l,o,r]);return a.useCallback((a=>{if(a.size>o)return Promise.reject(new Error(n(a)));var l=m(a.name);if(!l||!e.includes(l))return Promise.reject(new Error(i(a)));var t=_.includes(l);return"video"===r||void 0===r&&t?Promise.resolve():new Promise(((e,o)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),e()},r.onerror=()=>o(new Error(i(a))),r.src=URL.createObjectURL(a)}))}),[e,o,i,n,r])},T={__key:0xb2297e652d71,id:"b2297e652d71948928cdb40b36de579c",loc:{},definitions:[]},y={__key:0x5df6eb18541e,id:"5df6eb18541ec9881fec65ad2ab088fe",loc:{},definitions:[]},k=(e,o,a,r)=>{e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatus",description:o.statusText}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailStatusCode",description:o.status}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFailResponse",description:o.response.toString()}}}),e({PhotoUploadFlow:{photoUploadWeb:{action:"uploadFail",description:`${a+1} of ${r}`}}})},S=()=>{var e=p(),[o,r]=a.useState(),l=a.useRef(!1);a.useEffect((()=>(l.current=!0,()=>{l.current=!1})),[]);var[,t]=v(T),[,i]=v(y),n=a.useCallback((e=>{if(l.current)return e;throw new Error("upload aborted")}),[]),d=a.useCallback((({mediaType:o,file:a,description:l,locationId:d,isForCuration:s},p,u)=>{var c={description:l,mediaType:"video"===o?"VIDEO":"PHOTO",mimeType:a.type,fileName:a.name,fileSize:a.size,locationIds:null!=d&&d>0?[d]:[],isForCuration:s};return("video"===o?t({request:c}):(e=>new Promise(((o,a)=>{var r=new Image;r.onload=()=>{URL.revokeObjectURL(r.src),o({width:r.width,height:r.height})},r.onerror=a,r.src=URL.createObjectURL(e)})))(a).then((({width:e,height:o})=>t({request:{...c,width:e,height:o}})))).then(n).then((({data:l,error:t})=>{var i,n,d;if(t||"OK"!==(null==l||null==(i=l.initiateMediaUpload)?void 0:i.status)||null==(null==l||null==(n=l.initiateMediaUpload)?void 0:n.mediaId)||null==(null==l||null==(d=l.initiateMediaUpload)?void 0:d.uploadUrl))throw new Error("Upload failed");var{mediaId:s,uploadUrl:c}=l.initiateMediaUpload;return((e,o,a,l,t,i,n,d)=>new Promise(((d,s)=>{var u=new XMLHttpRequest;u.open("PUT",a,!0),u.onload=()=>{200===u.status?(n||l({PhotoUploadFlow:{photoUploadWeb:{action:"uploadSuccess",description:`${t+1} of ${i}`}}}),d(o)):(n||k(l,u,t,i),s(new Error(`Upload of file ${e.name} failed.`)))},u.onerror=()=>{n||k(l,u,t,i),s(new Error(`Upload of file ${e.name} failed.`))},u.onabort=()=>s(new Error(`Upload of file ${e.name} aborted.`)),u.upload.onprogress=e=>{return o=e.loaded,r((e=>{var a=null==e?[]:[...e];return a[p]=o,a}));var o},u.send(e)})))(a,s,c,e,p,u.length,"video"===o)})).then(n).then((e=>i({request:{mediaId:e}}).then((()=>({mediaId:e,mediaType:o}))))).finally((()=>{r(null)}))}),[t,i,n,e]);return[{progress:o},a.useCallback((e=>Promise.all(e.map(d))),[d])]},x=({mediaType:e,withMetadata:o,isForCuration:r,allowedFileTypes:l,maxFileSize:i,maxAllowedFiles:n,locationId:d})=>{var s=p(),{localize:u}=t(),c=P(l,i,e),[m,h]=a.useState({media:[],error:null}),f=a.useCallback((e=>{h((o=>({...o,error:e})))}),[]),[g,v]=a.useState(!1),U="video"===e,F=U?w.maxAllowedFiles:b.maxAllowedFiles,_=a.useCallback((o=>{c(o).then((()=>{h((a=>a.media.some((e=>{return a=e.file,r=o,a.name===r.name&&a.size===r.size;var a,r}))?a:a.media.length>=n?n!==F?a:{error:U?u.string("video_upload_max_number",{nVideos:n}):u.string("post_photo_tips_guidelines"),media:a.media}:{error:a.error,media:[...a.media,{mediaType:e,file:o,description:"",locationId:d,isForCuration:r}]}))})).catch((e=>{U||s({PhotoUploadFlow:{photoUploadWeb:{action:"invalidFile",description:e.message}}}),f(e.message)}))}),[c,n,r,d,u,f,e,F,U,s]),T=a.useCallback((e=>{f(null),e.preventDefault(),[...e.target.files].forEach(_),U||s({PhotoUploadFlow:{photoUploadWeb:{action:"fileSelectedFilePicker",description:m.media.length.toString()}}}),e.currentTarget.value=""}),[_,f,s,U,m.media.length]),y=a.useCallback(((e,o)=>{h((a=>{var r=[...a.media];return r[e]=o,{error:null,media:r}}))}),[]),k=a.useCallback((e=>{h((o=>{var a=[...o.media];return a.splice(e,1),{error:null,media:a}}))}),[]),{dragging:x}=C((e=>{f(null),e.forEach(_)}),U?null:m.media),I=!g&&m.media.length>0&&(!o||!U&&r||m.media.every((e=>e.description&&null!=e.locationId&&e.locationId>0))),[{progress:E},M]=S(),z=a.useCallback((()=>I?(U||s({PhotoUploadFlow:{photoUploadWeb:{action:"submitClicked"}}}),v(!0),f(null),M(m.media).then((e=>(U||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedAll"}}}),v(!1),e))).catch((()=>{U||s({PhotoUploadFlow:{photoUploadWeb:{action:"uploadedErrorExists"}}});var e=U?u.string("video_upload_fail"):u.string("post_photo_upload_failed");f(e),v(!1)}))):Promise.reject()),[M,I,m.media,f,u,U,s]);return{media:m.media,error:m.error,uploading:g,progress:E,canAddMore:m.media.length<n,canSubmit:I,dragging:x,onFileSelected:T,onMediaChanged:y,onMediaDeleted:k,onSubmit:z}},I=({children:e,...o})=>{var[r]=a.useContext(n),t=a.useRef(),i={...b,...o,allowedFileTypes:[".jpg",".jpeg",".gif",".png",".mp4",".m4v",".mov"]},[s,p]=a.useState([]),[{progress:h},f]=S(),g=P(i.allowedFileTypes,i.maxFileSize),v=a.useRef([]),F=a.useCallback((e=>{v.current.splice(0,0,e)}),[]),_=a.useCallback((e=>{var o=v.current.findIndex((o=>e===o));v.current.splice(o,1)}),[]),T=a.useCallback((e=>{Promise.all(e.map((e=>g(e)))).then((()=>{var o=e.map((e=>({mediaType:w.allowedFileTypes.includes(m(e.name))?"video":"photo",file:e,locationId:null,description:"",isForCuration:i.isForCuration})));return p(o),f(o)})).then((e=>{v.current.find((o=>!1!==o(e)))})).catch((e=>{r({node:u(d,{children:e.message||u(l,{id:"post_photo_upload_failed"})})})})).finally((()=>{p([])}))}),[g,f,r,i.isForCuration]),{dragging:y}=C(T,s),k=a.useCallback((()=>{var e=t.current;if(null==e)throw new Error("useCustomPhotoUploadFlow: must render the supplied element");e.click()}),[]),x=a.useMemo((()=>({photos:s,open:k,dragging:y,progress:h,addPhotosUploadedCallback:F,removePhotosUploadedCallback:_})),[s,k,y,h,F,_]);return c(U.Provider,{value:x,children:[e,u("input",{ref:t,type:"file",multiple:i.maxAllowedFiles>1,accept:i.allowedFileTypes.join(","),style:{display:"none"},onChange:e=>{e.preventDefault(),T([...e.currentTarget.files].filter(Boolean)),e.currentTarget.value=""},"aria-hidden":!0,tabIndex:-1})]})},E=e=>{var{addPhotosUploadedCallback:o,removePhotosUploadedCallback:r,...l}=a.useContext(U),t=a.useRef(e);return t.current=e,a.useEffect((()=>{if(null==t.current)return()=>{};var e=(...e)=>!!t.current&&t.current(...e);return o(e),()=>{r(e)}}),[o,r]),l},M=(e=Object.freeze({}))=>{var o=p(),{login:t}=s(),[i]=a.useContext(n),c=a.useRef((()=>{})),{open:m}=r((({close:o})=>u(F,{...e,onUploadCanceled:()=>{o(),c.current([])},onUploadSuccess:(...a)=>{o(),i({node:u(d,{children:"video"===e.mediaType?u(l,{id:"success_repost_video"}):u(l,{id:"success_repost_photo"})})}),c.current(...a)}})),{},[e,i]);return a.useCallback((()=>t({flow:"CORE_COMBINED"}).then((()=>(m(),"video"!==e.mediaType&&o({PhotoUploadFlow:{photoUploadWeb:{action:"opened"}}}),new Promise((e=>{c.current=e})))))),[t,m,o,e.mediaType])};return[()=>{b={mediaType:"photo",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".jpg",".jpeg",".gif",".png"],maxFileSize:h,maxAllowedFiles:10,locationId:-1},w={mediaType:"video",withMetadata:!0,isForCuration:!1,allowedFileTypes:[".mp4",".m4v",".mov"],maxFileSize:f,maxAllowedFiles:5,locationId:-1},U=a.createContext({photos:[],open:()=>{},dragging:!1,progress:null,addPhotosUploadedCallback:()=>{},removePhotosUploadedCallback:()=>{}}),F=i.onUsage((()=>o("S07X1M/v-c-G4")),"default"),e({C:I,a:b,b:M,c:E,d:w,u:x})},[e=>a=e.default,e=>r=e.useVDOMPortal,e=>(l=e.default,t=e.useLocalize),e=>i=e.component,e=>(n=e.Toast,d=e.ToastItem),e=>s=e.default,e=>p=e.useInteractionLogger,e=>(u=e.jsx,c=e.jsxs),e=>(m=e.fileExtension,h=e.maxImageUploadSizeInBytes,f=e.maxVideoUploadSizeInBytes),e=>g=e.useWindow,e=>v=e.useMutation]]},["cDcdfi","vq6MSq","0DsHEV","pLbCP4","Q7TAd7","VANuRt","fsml46","F5FCuN","V_I8wA","Dg5_-9","5X2em-"]]);
